================================================================================
PROMPT DETALLADO PARA REPLIT – FRONTEND COHORTLENS
================================================================================
Plataforma de CRM Analytics con segmentación, predicción, IA y Web3.
Usa este prompt en Replit para generar el frontend completo.
================================================================================

=== 1. CONTEXTO DEL PROYECTO ===

CohortLens es una plataforma de analytics de CRM que permite:
- Segmentar clientes (KMeans/GMM/DBSCAN)
- Predecir gasto (spending score 0-100)
- Recomendaciones con IA (Groq/LLM)
- Monitoreo de data drift (PSI, KS)
- Reportes ejecutivos (HTML/PDF, IPFS)
- Consentimiento verificable (SSI/DID) y almacenamiento descentralizado

El backend es una API REST FastAPI ya desplegada. El frontend debe consumirla.

================================================================================

=== 2. STACK TECNOLÓGICO (OBLIGATORIO) ===

- Framework: Next.js 14+ App Router
- Lenguaje: TypeScript (strict)
- Estilos: Tailwind CSS
- Componentes: shadcn/ui (Radix) o similar
- Gráficos: Recharts
- Iconos: Lucide React (NO usar emojis)
- Data fetching: TanStack Query (React Query)
- Formularios: React Hook Form + Zod
- Estado: React useState/useReducer; localStorage para persistencia
- HTTP: fetch nativo
- Fuentes: Inter o Geist

================================================================================

=== 3. API BASE ===

URL base: process.env.NEXT_PUBLIC_API_URL || "http://127.0.0.1:8000"
Todas las rutas: /api/v1/...
No hay autenticación obligatoria (acceso sin login).

Endpoints:

GET  /api/v1/health
     → { status, service, version, neon_db, ipfs }

GET  /api/v1/usage
     → { tenant_id, current_month_calls }

POST /api/v1/predict-spending
     Body: { age, annual_income, work_experience, family_size, profession? }
     → { predicted_spending, confidence }

GET  /api/v1/predict-spending/explain?age=&annual_income=&work_experience=&family_size=&profession=
     → { feature_importance: { [key]: number } }

POST /api/v1/segment
     Body: [ { "Age", "Annual Income ($)", "Spending Score (1-100)" }, ... ]
     → { clusters: number[] }

POST /api/v1/recommendations/natural
     Body: { query: string }
     → { recommendation: string }

GET  /api/v1/drift
     → { drift_detected, alerts?, features?: { [name]: { psi, ks_p_value, drift_detected, current_mean, baseline_mean } }, message? }

POST /api/v1/drift/save-baseline
     → { status, baseline_path? }

POST /api/v1/reports/generate
     Body: { metrics?: string[], figures?: string[], format?: string, upload_to_ipfs?: boolean }
     → { status, report_id, output_path, format }

GET  /api/v1/audit-log?table_name=&record_id=&limit=
     → { entries: [...], count }

POST /api/v1/consent/register
     Body: { customer_id, consent_type, granted }
     → { success }

GET  /api/v1/consent/{customer_id}?consent_type=
     → { consents: [{ consent_type, granted, created_at? }] }

================================================================================

=== 4. PÁGINAS OBLIGATORIAS ===

1. Dashboard (/)
   - Tarjetas: API health, Usage, Web3 summary
   - Quick actions: Predict, Segment, AI, Reports
   - Actividad reciente (placeholder o historial local)

2. Predict (/predict)
   - Formulario: Age, Annual income, Work experience, Family size, Profession
   - Resultado: Predicted spending (0-100), Confidence
   - Botón "Explain" → muestra feature_importance como gráfico de barras
   - Extras: Comparar 2 predicciones lado a lado
   - Extras: Historial de predicciones (localStorage) con "Usar de nuevo"

3. Segment (/segment)
   - Textarea para JSON array de clientes
   - Botón "Sample data" con datos de ejemplo
   - Resultado: Tabla con Row, Age, Annual Income, Spending Score, Cluster
   - Extras: Gráfico de dispersión (scatter) de clusters por income vs spending
   - Extras: Exportar resultado como CSV

4. AI Recommendations (/recommendations)
   - Input de texto para pregunta
   - Respuesta con formato (preservar saltos de línea)
   - Extras: Historial de Q&A (últimos 5)
   - Extras: Sugerencias rápidas: "Mejores segmentos para upselling", "Cómo reducir churn", etc.

5. Data Drift (/drift)
   - Botones: Check drift, Save baseline
   - Resultado: Badge drift_detected, lista de alerts
   - Tabla: Feature, PSI, KS p-value, Drift, Current mean, Baseline mean
   - Extras: Gráfico de barras comparando current vs baseline por feature

6. Reports (/reports)
   - Form: Métricas (MSE, MAE, R²), Figuras (clusters, correlation, gender, savings), Format (html/pdf), Upload to IPFS
   - Resultado: report_id, output_path, link "Open report"
   - Extras: Preview de reportes anteriores (si hay lista de reportes en localStorage)

7. Audit Log (/audit)
   - Filtros: table_name, record_id, limit
   - Tabla: ID, Table, Record ID, Action, Old/New values (expandibles), User, Date

8. Consent (SSI/DID) (/consent)
   - Form: customer_id, consent_type (data_share, marketing, analytics), granted
   - Check: customer_id, consent_type opcional
   - Tabla de resultados
   - Extras: Badge "Web3" o "On-chain ready"

9. Web3 / Blockchain (/web3)
   - Tarjetas: Consent (SSI), IPFS Storage, Token Rewards, Verifiable Credentials
   - Descripción de cada módulo
   - Links a Consent y Reports
   - Extras: "Conecta wallet" placeholder (solo UI, no funcionalidad)
   - Extras: Lista de CIDs recientes (si backend expusiera endpoint)

10. Usage (/usage)
    - Muestra tenant_id, current_month_calls
    - Extras: Barra de progreso si hay límite de plan (ej. 10000/mes)

================================================================================

=== 4B. AUTENTICACIÓN Y USUARIO (OBLIGATORIO) ===

El usuario puede iniciar sesión de TRES formas:

1. Email + contraseña
   - Formulario: email, password
   - Endpoint mock o POST /api/v1/auth/login (body: { email, password } → { access_token, user })
   - Opción "¿Olvidaste tu contraseña?" → link a recuperar

2. Wallet (MetaMask, Coinbase Wallet, etc.)
   - Botón "Conectar wallet"
   - Usa wagmi + viem o ethers.js
   - Al conectar: firma de mensaje para verificación (SIWE opcional)
   - Muestra dirección truncada (0x1234...5678) en header cuando conectado
   - WalletConnect v2 para móvil (modal con QR)

3. Google OAuth
   - Botón "Continuar con Google"
   - Integración con Google Sign-In (next-auth o firebase/auth)
   - Redirect OAuth o popup

Flujo:
- Header: si NO logueado → botón "Iniciar sesión" que abre modal/drawer con 3 opciones
- Header: si logueado → avatar + menú (Perfil, Configuración, Cerrar sesión)
- Rutas premium (Predict, Segment, Reports, etc.) pueden requerir auth; si no hay sesión, mostrar CTA para loguearse (opcional: permitir uso limitado sin auth)

Dependencias sugeridas: wagmi, viem, @web3modal/wagmi o RainbowKit (WalletConnect), next-auth o firebase/auth (Google).

================================================================================

=== 4C. WALLET, WALLET CONNECT Y L2 (OBLIGATORIO) ===

1. Wallet
   - Componente "Wallet" en header (icono Wallet de Lucide)
   - Al hacer clic: si desconectado → abre modal "Conectar wallet"
   - Modal: opciones MetaMask, Coinbase Wallet, WalletConnect (QR para móvil)
   - Si conectado: dropdown con dirección truncada, balance (ETH/mock), red actual, botón "Desconectar"
   - Mostrar red: Mainnet, Polygon, Arbitrum, Optimism, Base (L2s)

2. WalletConnect
   - Integrar WalletConnect v2 (o viem + @walletconnect/ethereum-provider)
   - En móvil: escanear QR para conectar desde app nativa
   - Persistir sesión en localStorage

3. L2 (Layer 2)
   - Selector de red: Mainnet, Polygon, Arbitrum One, Optimism, Base
   - Badge "L2" junto a Polygon/Arbitrum/Optimism/Base cuando esté activo
   - Transacciones (si las hubiere) preferir L2 por coste bajo
   - En Dashboard: card "Red activa: Arbitrum" o similar

4. Multichain (opcional)
   - Indicador de chain ID en header
   - Switch de red con un clic (si el usuario tiene la red añadida)

================================================================================

=== 4D. DeFi, NFTs Y MÓDULOS CRYPTO (OBLIGATORIO) ===

1. DeFi
   - Página /defi o sección en /web3
   - Tarjetas:
     * Staking: "Stake CLT → gana recompensas" (mock: APY 12%, TVL $X)
     * Liquidity: "Proporciona liquidez" (mock: par CLT/ETH, APR)
     * Farming: "Yield farming" (mock: pools activos)
   - Tabla de posiciones (mock): Token, Cantidad, Valor, APY
   - Gráfico mini: evolución de balance (simulado)
   - Botón "Depositar" / "Retirar" (UI only, no ejecuta tx real si no hay backend)

2. NFTs
   - Página /nfts o sección en /web3
   - Grid de NFTs del usuario (mock o llamada a API si existe)
   - Cada card: imagen placeholder, nombre, colección, "CohortLens Pass", "Segment Badge"
   - Concepto: NFTs como credenciales de segmento o membresía
   - "Mint" (mock): "Mint tu Segment Badge" – form con segment_id, preview
   - Empty state: "No tienes NFTs. Conecta tu wallet o mintea uno."
   - Soporte para OpenSea-style metadata (name, description, image)

3. Token rewards (CLT)
   - Card en Dashboard: "CLT Balance: 1,234" (mock)
   - Historial: "Recompensas por uso" – lista de eventos (Predicción +10, Segmentación +25, Reporte +50)
   - Badge "Earn CLT" en acciones que dan puntos

4. Puente L1↔L2 (opcional)
   - UI: "Bridge CLT a Arbitrum" – input cantidad, botón "Bridge"
   - Solo interfaz; no ejecuta puente real sin backend/contrato

================================================================================

=== 5. TEMAS (OBLIGATORIO) ===

- Light: fondo claro, texto oscuro, primary indigo
- Dark: fondo oscuro, texto claro
- Neon: alto contraste, fondo casi negro, primary cyan (#00d4ff), accent magenta, bordes con glow sutil

Selector en header: dropdown con Light / Dark / Neon. Persistir en localStorage.

================================================================================

=== 6. DISEÑO ===

- Estilo: moderno, minimalista
- Iconos: SOLO Lucide (Sun, Moon, Zap, Calculator, Users, MessageSquare, Activity, FileText, Shield, Zap, Link2, CheckCircle, AlertCircle, etc.)
- NO emojis
- Cards: bordes redondeados (rounded-xl), sombra sutil
- Sidebar colapsable en móvil
- Skip link "Skip to main content" para accesibilidad

================================================================================

=== 7. EXTRAS SOLO FRONTEND (CREATIVIDAD) ===

1. Gráficos avanzados (Recharts):
   - Scatter de clusters (Income vs Spending, color por cluster)
   - Barras horizontales para feature_importance (Explain)
   - Barras comparativas current vs baseline (Drift)
   - Pie/donut de distribución de clusters
   - Mini sparkline de uso API en los últimos 7 días (simulado si no hay datos)

2. Web3 visual:
   - Badge "IPFS" cuando un reporte se sube a IPFS
   - Indicador "Consent on-chain" en consent
   - Sección "Token balance" placeholder (Wallet: 0 CLT)
   - Animación sutil en cards Web3 (hover con borde cyan)

3. AI visual:
   - Indicador "Thinking..." con animación durante recomendación
   - Respuesta con markdown básico (negritas, listas)
   - Botón "Copy" para copiar recomendación

4. Comandos rápidos:
   - Ctrl+K abre modal con búsqueda de rutas (Dashboard, Predict, Segment, etc.)

5. Onboarding:
   - Modal "Bienvenido a CohortLens" en primera visita (localStorage)
   - 3 bullets: Segmenta, Predice, Actúa

6. Empty states:
   - Mensaje claro cuando no hay datos: "Pega un JSON o usa datos de ejemplo"
   - Ilustración mínima o icono grande

7. Toasts:
   - Éxito (verde), Error (rojo), Info (azul)
   - Posición: bottom-right

================================================================================

=== 8. ESTRUCTURA SUGERIDA ===

app/
  page.tsx          → redirect a /dashboard
  layout.tsx
  globals.css
  (dashboard)/
    layout.tsx      → Sidebar + Header
    dashboard/page.tsx
    predict/page.tsx
    segment/page.tsx
    recommendations/page.tsx
    drift/page.tsx
    reports/page.tsx
    audit/page.tsx
    consent/page.tsx
    web3/page.tsx
    usage/page.tsx
components/
  layout/
  dashboard/
  predict/
  segment/
  ...
lib/
  api.ts
  types.ts
  utils.ts

================================================================================

=== 9. VARIABLES DE ENTORNO ===

NEXT_PUBLIC_API_URL=http://127.0.0.1:8000

================================================================================

=== 10. MANEJO DE ERRORES ===

- 429: "Plan limit exceeded"
- 404: "Recurso no encontrado"
- Cualquier error de red: "No se pudo conectar con la API. Verifica que el backend esté corriendo."
- Mostrar toasts en lugar de alertas nativas

================================================================================

INSTRUCCIONES FINALES:
1. Genera el frontend completo en Replit
2. Usa las tecnologías indicadas
3. Implementa TODAS las páginas y extras
4. Asegura que funcione sin login
5. Aplica temas Light, Dark y Neon
6. Usa iconos Lucide, NUNCA emojis
7. Diseño moderno y minimalista
